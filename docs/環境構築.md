# Poetry + pytest + mypy + Docker + Python 3.12 é–‹ç™ºç’°å¢ƒæ§‹ç¯‰ã‚¬ã‚¤ãƒ‰ï¼ˆVSCode Remote - Containersç‰ˆï¼‰

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€VSCode ã® Remote - Containers æ‹¡å¼µã‚’ç”¨ã„ã¦ã€Python 3.12 + Poetry + pytest + mypy ç’°å¢ƒã‚’ Docker ä¸Šã«æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

---

## âœ… å‰ææ¡ä»¶

### Windows / macOS å…±é€š

* [Docker Desktop](https://www.docker.com/products/docker-desktop/) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
* [VSCode](https://code.visualstudio.com/) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
* VSCode æ‹¡å¼µæ©Ÿèƒ½ï¼š

  * Remote - Containers
  * Python
  * Pylance

---

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
python_workshop/
â”œâ”€â”€ .devcontainer/
â”‚   â”œâ”€â”€ devcontainer.json
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ pyproject.toml         # Poetryã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ src/                   # Pythonã‚³ãƒ¼ãƒ‰ç½®ãå ´
â”‚   â””â”€â”€ main.py
```

---

## ğŸ“„ .devcontainer/devcontainer.json

```json
{
  "name": "Python 3.12 + Poetry",
  "build": {
    "dockerfile": "Dockerfile",
    "context": ".."
  },
  "settings": {
    "terminal.integrated.defaultProfile.linux": "bash"
  },
  "extensions": [
    "ms-python.python",
    "ms-python.vscode-pylance"
  ],
  "postCreateCommand": "poetry install --no-root",
  "remoteUser": "vscode"
}
```

---

## ğŸ“„ .devcontainer/Dockerfile

```dockerfile
FROM python:3.12-slim

RUN apt-get update && apt-get install -y \
    curl build-essential git && \
    apt-get clean

# Poetryã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆrootãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ï¼‰
RUN curl -sSL https://install.python-poetry.org | python3 - && \
    ln -s /root/.local/bin/poetry /usr/local/bin/poetry

ENV POETRY_VIRTUALENVS_CREATE=false

WORKDIR /workspace

COPY pyproject.toml poetry.lock* ./
RUN poetry install --no-root --no-interaction --no-ansi

COPY . .

# vscodeãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ï¼ˆæœ€å¾Œã«åˆ‡ã‚Šæ›¿ãˆï¼‰
RUN useradd -m vscode
USER vscode
```

---

## ğŸ“„ pyproject.toml

```toml
[tool.poetry]
name = "python_workshop"
version = "0.1.0"
description = "Python 3.12 + Poetry Dev Environment"
authors = ["Your Name <your@email.com>"]

[tool.poetry.dependencies]
python = "^3.12"

[tool.poetry.group.dev.dependencies]
pytest = "^8.0"
mypy = "^1.8"
flake8 = "^7.0"
black = "^24.3"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
```

---

## ğŸ§ª ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ï¼ˆsrc/main.pyï¼‰

```python
def greet(name: str) -> str:
    return f"Hello, {name}!"

if __name__ == "__main__":
    print(greet("Python"))
```

---

## ğŸš€ å®Ÿè¡Œæ–¹æ³•ï¼ˆRemote - Containersï¼‰

1. VSCode ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’é–‹ã
2. å·¦ä¸‹ã®ã€Œ><ã€ãƒãƒ¼ã‚¯ â†’ "Reopen in Container"
3. è‡ªå‹•çš„ã«ã‚³ãƒ³ãƒ†ãƒŠãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã€Poetryã§ä¾å­˜ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™
4. ã‚³ãƒ³ãƒ†ãƒŠã®ä¸­ã§ä»¥ä¸‹ãŒå®Ÿè¡Œå¯èƒ½ï¼š

```bash
poetry run python src/main.py
poetry run pytest
poetry run mypy src/
```

---

## âœ… è£œè¶³

* `.devcontainer/` ã‚’Gitç®¡ç†ã™ã‚Œã°ãƒãƒ¼ãƒ ã§ç’°å¢ƒçµ±ä¸€ãŒå¯èƒ½
* `poetry add XXX` ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¿½åŠ ï¼ˆä¾‹ï¼šrequestsï¼‰
* Poetryä»®æƒ³ç’°å¢ƒã‚’Dockerå¤–ã«ä½œã‚ŠãŸã„å ´åˆã¯ `POETRY_VIRTUALENVS_CREATE=true` ã«å¤‰æ›´



